<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>俄罗斯方块</title>
  <style>
    .box{
      width: 400px;
      height: 600px;
      margin: 0 auto;
      border: #555555 solid 1px;
    }
  </style>
</head>
<body>
<div class="box">
<canvas id="mycanvas" width="400px" height="600px"></canvas>

<script>
/**
 思路：将画布分成等宽高的正方形并进行编号，不同的方块占不同的编号格
  */

let canvasWidth,canvasHeight,ctx,myInterval,
    size=20, //画正方形的大小
    row,col, //画布总共有几行几列
    currentList=[],current,currentNumber,//当前移动的是方块所所占方块
    existList=[]   //已经下去的方块位置集合
;
window.onload=function () {
  let mycanvas = document.getElementById('mycanvas');
  ctx = mycanvas.getContext('2d');
  canvasWidth=mycanvas.width;
  canvasHeight=mycanvas.height;

  //监听键盘的上右下左，方向不能逆向该变
  // document.onkeydown = function (event) {
  //   let e = event || window.event || arguments.callee.caller.arguments[0];
  //   if (e && e.keyCode == 40) { //下
  //
  //   }else  if (e && e.keyCode == 37) { //左
  //
  //   }else if (e && e.keyCode == 39) { //右
  //
  //   }
  //   else if (e && e.keyCode == 38) { // 上
  //
  //   }
  //
  // };


  // setMyInterval()
  init()
}

function init() {
  //总共多少行
  row=canvasHeight/size;
  //总共多少列
  col=canvasWidth/size

  currentNumber=col/2;
  current = getNumRepeat(5);
  random(current);
  setMyInterval()
}

function setMyInterval() {

  myInterval=setInterval(function () {
    ctx.clearRect(0,0,canvasWidth,canvasHeight);

    currentNumber += col;
    random(current);

  },100)
}
//根据不同的编号画出一个正方形
function drawSquare(number) {

  //获取总的编号
  let count = row*col;

  //传入的编号不得大于总编号
  if(number>0 && number<=count){
    //判断该编号在几排几列
    let numberCol=number%col==0?col:number%col;
    let numberRow=Math.ceil(Math.abs(number-numberCol)/col)+1

    //根据行列获取坐标
    let numberX=(numberCol-1)*size;
    let numberY=(numberRow-1)*size;


    //根据坐标画正方形
    ctx.fillStyle='#555555';
    ctx.fillRect(numberX,numberY,size,size)
    ctx.beginPath();
    ctx.lineWidth='2'
    ctx.strokeStyle='#000'
    ctx.rect(numberX,numberY,size,size)
    ctx.stroke()
  }
}

//随机生成一个方块在顶部开始下落
function random(current) {
  let number=col/2;
  switch (current) {
    case 1:currentList=[number,number-col,number-col*2,number-col*3];break;
    case 2:currentList=[number,number+1,number-col,number-col*2];break;
    case 3:currentList=[number,number+1,number-col,number-col+1];break;
    case 4:currentList=[number,number-col,number-col-1,number-col+1];break;
    case 5:currentList=[number,number+1,number-col,number-col-1];break;
  }
}
//随机生成1——5的数字
function getNumRepeat (maxNum) {
  return Math.floor(Math.random()*maxNum)+1;
}
/**
 *生成五种方块I,L,O,T,Z
 */
function drawBlock() {
  currentList.map((item,index)=>{
    drawSquare(item);
  })
}

function drawI(number) {
  drawSquare(number)
  drawSquare(number-col)
  drawSquare(number-col*2)
  drawSquare(number-col*3)
}
function drawL(number) {
  drawSquare(number)
  drawSquare(number+1)
  drawSquare(number-col)
  drawSquare(number-col*2)
}
function drawO(number) {
  drawSquare(number)
  drawSquare(number+1)
  drawSquare(number-col)
  drawSquare(number-col+1)
}
function drawT(number) {
  drawSquare(number)
  drawSquare(number-col)
  drawSquare(number-col+1)
  drawSquare(number-col-1)
}
function drawZ(number) {
  drawSquare(number)
  drawSquare(number+1)
  drawSquare(number-col)
  drawSquare(number-col-1)
}

</script>
</div>
</body>
</html>